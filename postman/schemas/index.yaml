openapi: "3.0.0"
info:
    version: "0.0.1"
    title: "Game Repository API"
    description: Game Repository REST API

servers:
    - url: https://sad.capass.org
      description: Stage server (public available)
    - url: http://localhost:3000
      description: Local server (used for  localdevelopment)

paths:
    /games/{id}:
        parameters:
            - name: id
              description: Game identifier
              in: path
              required: true
              schema:
                  type: integer
                  format: int64
        get:
            summary: Retrieve a game by id
            description: Retrieve a game by id
            tags:
                - games
            responses:
                "200":
                    description: The game corresponding to the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Game"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: No game found for the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

        put:
            summary: Update a game
            description: Update a game by id
            tags:
                - games
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                name:
                                    type: string
                                currentRound:
                                    type: integer
                        example:
                            name: "New Game name"
                            currentRound: 2

            responses:
                "200":
                    description: Updated
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Game"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

        delete:
            summary: Delete a Game
            description: Delete a game by id
            tags:
                - games
            responses:
                "204":
                    description: Game deleted
                "404":
                    description: No game found for the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

    /games:
        post:
            tags:
                - games
            summary: Create a Game
            description: Create a game
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                playersCount:
                                    type: integer
                                name:
                                    type: string
                        example:
                            name: Game name
                            playersCount: 5

            responses:
                "201":
                    description: Created
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Game"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
        get:
            tags:
                - games
            summary: Retrieve games by date interval
            description: Retrieve games in the system within an interval and paginated. Default interval is current day.
            parameters:
                - in: query
                  name: startDate
                  description: First date for the interval. Must bee in YYYY-MM-DD format
                  schema:
                      type: string
                      format: date
                      default: "2022-01-30"
                  required: false
                  example:
                - in: query
                  name: endDate
                  description: Last date for the interval. Must bee in YYYY-MM-DD format
                  schema:
                      type: string
                      format: date
                      default: "2023-12-31"
                  required: false
                - in: query
                  name: page
                  description: Page number to retrieve
                  schema:
                      type: integer
                      format: int64
                      minimum: 1
                      default: 1
                  required: false
                - in: query
                  name: pageSize
                  description: Number of items per page
                  schema:
                      type: integer
                      format: int64
                      minimum: 10
                      default: 100
                  required: false
            responses:
                "200":
                    description: Games in the inteval
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GetGamesResponse"

    /rounds/{id}:
        parameters:
            - name: id
              description: Round identifier
              in: path
              required: true
              schema:
                  type: integer
                  format: int64
        get:
            summary: Retrieve a round
            description: Retrieve a round by id
            tags:
                - rounds
            responses:
                "200":
                    description: The Round corresponding to the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Round"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: No round found for the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
        put:
            summary: Update a round
            description: Update a round by id
            tags:
                - rounds
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                order:
                                    type: integer
                        example:
                            order: 2
            responses:
                "200":
                    description: The updated round
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Round"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: No round found for the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

        delete:
            summary: Delete a round
            description: Delete a round by id
            tags:
                - rounds
            responses:
                "204":
                    description: Round deleted
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: No Round found for the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

    /rounds:
        post:
            summary: Creates a round
            description: Create a round
            tags:
                - rounds
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                gameId:
                                    type: integer
                                    format: int64
                                testClassId:
                                    type: string
                                order:
                                    type: integer
                        example:
                            gameId: 1
                            testClassId: "a_test_class.java"
                            ordrer: 1
            responses:
                "201":
                    description: Created
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Round"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
        get:
            summary: Retrieve rounds per game
            description: Retrieve all rounds given a game id
            tags:
                - rounds
            parameters:
                - in: query
                  name: gameId
                  description: Id of the game
                  schema:
                      type: integer
                      format: int64
                  required: true

            responses:
                "200":
                    description: List of rounds
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: "#/components/schemas/Round"
                "404":
                    description: No game found for the provided id
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "400":
                    description: Invalid game id
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

    /turns/{id}:
        parameters:
            - name: id
              description: Turn identifier
              in: path
              required: true
              schema:
                  type: integer
                  format: int64

        get:
            summary: Retrieve a turn
            description: Retrieve a turn by id
            tags:
                - turns
            responses:
                "200":
                    description: The Turn corresponding to the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Turn"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: No Turn found for the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

        put:
            summary: Update a turn
            description: Update a turn by id
            tags:
                - turns
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                scores:
                                    type: string
                                isWinner:
                                    type: boolean
                        example:
                            scores: "a new score in JSON format"
                            isWinner: true

            responses:
                "200":
                    description: Updated
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Turn"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: Not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

        delete:
            summary: Delete a turn
            description: Delete a turn by id
            tags:
                - turns
            responses:
                "204":
                    description: Turn deleted
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: No Turn found for the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

    /turns/{id}/files:
        parameters:
            - name: id
              description: Turn identifier
              in: path
              required: true
              schema:
                  type: integer
                  format: int64
        put:
            summary: Upload turn files
            description: Upload turn files as a zip
            tags:
                - turns
            requestBody:
                required: true
                content:
                    application/zip:
                        schema:
                            type: string
                            format: binary
            responses:
                "200":
                    description: File uploaded successfully
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: No Turn found for the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
        get:
            summary: Download turn files
            description: Download turn files as a zip
            tags:
                - turns
            responses:
                "200":
                    description: Bad request
                    content:
                        application/zip:
                            schema:
                                type: string
                                format: binary

                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: No Turn found for the provided `Id`
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

    /turns:
        get:
            summary: Retrieve turns in a round
            description: Retrieve all turns in a round
            tags:
                - turns
            parameters:
                - in: query
                  name: roundId
                  description: Id of the round
                  schema:
                      type: integer
                      format: int64
                  required: true
            responses:
                "200":
                    description: List of turns
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: "#/components/schemas/Turn"
                "404":
                    description: No round found for the provided id
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "400":
                    description: Invalid round id
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
        post:
            tags:
                - turns
            summary: Create a turn
            description: Create a turn in the system
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                playerId:
                                    type: integer
                                    format: int64
                                roundId:
                                    type: integer
                                    format: int64
                                scores:
                                    type: string
                        example:
                            playerId: 1
                            roundId: 1
                            scores: "score example"
            responses:
                "201":
                    description: Created
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Turn"
                "400":
                    description: Bad request
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "404":
                    description: No round or player found for the provided id
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"
                "500":
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/Error"

components:
    schemas:
        Game:
            type: object
            properties:
                id:
                    type: integer
                    format: int64
                currentRound:
                    type: integer
                createdAt:
                    type: string
                    format: date-time
                updatedAt:
                    type: string
                    format: date-time
                playersCount:
                    type: integer
                name:
                    type: string

        Round:
            type: object
            properties:
                id:
                    type: integer
                    format: int64
                testClassId:
                    type: string
                order:
                    type: integer
                createdAt:
                    type: string
                    format: date-time
                updatedAt:
                    type: string
                    format: date-time

        Turn:
            type: object
            properties:
                id:
                    type: integer
                    format: int64
                isWinner:
                    type: boolean
                createdAt:
                    type: string
                    format: date-time
                updatedAt:
                    type: string
                    format: date-time
                playerId:
                    type: integer
                scores:
                    type: string

        Error:
            type: "object"
            properties:
                message:
                    type: string

        GetGamesResponse:
            type: "object"
            properties:
                metadata:
                    type: object
                    properties:
                        hasNext:
                            type: boolean
                        count:
                            type: integer
                            format: int64
                        page:
                            type: integer
                            format: int64
                        pageSize:
                            type: integer
                            format: int64
                data:
                    type: array
                    items:
                        $ref: "#/components/schemas/Game"
